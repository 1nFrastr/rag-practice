# 数据恢复操作指南

当数据丢失或误删除时，按照本指南进行恢复操作。

## 紧急处理

**发现数据丢失后，立即执行：**
1. 停止对数据库的写操作
2. 通知DBA和运维团队
3. 记录问题发生时间和影响范围

## 恢复方案选择

### 方案1：从最近备份恢复

适用场景：有可用的完整备份

```bash
# PostgreSQL 恢复
pg_restore -h localhost -U postgres -d mydb backup.dump

# MySQL 恢复
mysql -u root -p mydb < backup.sql
```

### 方案2：时间点恢复（PITR）

适用场景：需要恢复到精确的时间点

```bash
# PostgreSQL 时间点恢复
recovery_target_time = '2024-11-15 10:30:00'
```

### 方案3：从binlog恢复（MySQL）

适用场景：恢复特定的误删操作

```bash
# 查看binlog事件
mysqlbinlog --start-datetime="2024-11-15 10:00:00" binlog.000001

# 恢复数据
mysqlbinlog --start-position=4 --stop-position=500 binlog.000001 | mysql -u root -p
```

### 方案4：使用回收站功能

如果系统实现了软删除，可以从回收站恢复：
```sql
UPDATE users SET deleted_at = NULL WHERE id = 12345;
```

## 恢复后验证

1. 检查数据完整性
2. 对比恢复前后的记录数
3. 抽样验证关键数据
4. 确认应用程序可正常访问

## 预防措施

- 定期测试备份恢复流程
- 实施软删除机制
- 关键操作添加二次确认

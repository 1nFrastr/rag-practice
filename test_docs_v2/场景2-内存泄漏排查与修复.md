# 内存泄漏排查与修复指南

当程序出现内存溢出（OOM）错误时，请按以下步骤排查和修复。

## 症状识别

- 程序运行一段时间后崩溃
- 报错信息：`java.lang.OutOfMemoryError` 或 `MemoryError`
- 服务响应越来越慢

## 排查步骤

### 1. 获取内存快照
```bash
# Java应用
jmap -dump:format=b,file=heap.hprof <pid>

# Python应用
import tracemalloc
tracemalloc.start()
```

### 2. 分析内存占用
- 使用MAT（Memory Analyzer Tool）分析heap dump
- 查找占用内存最大的对象
- 识别异常增长的对象类型

### 3. 常见内存泄漏原因

| 原因 | 解决方法 |
|------|----------|
| 未关闭的数据库连接 | 使用连接池，确保finally中关闭连接 |
| 大对象缓存无限增长 | 使用LRU缓存，设置最大容量 |
| 事件监听器未移除 | 在组件销毁时移除监听器 |
| 循环引用 | 使用弱引用（WeakReference） |

### 4. 修复验证

修复后监控内存使用情况，确认内存占用稳定不再持续增长。

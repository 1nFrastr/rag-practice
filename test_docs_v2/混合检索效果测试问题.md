# 混合检索效果测试问题

本测试集专门设计用于验证**混合检索**和**重排序**功能的效果。每个场景都包含多个共享关键词的文档，只有一个是真正匹配用户意图的。

---

## 测试方法

### 三种模式对比

| 模式 | 配置 | 预期效果 |
|------|------|----------|
| 纯向量 | hybrid_search=OFF, rerank=OFF | 可能被语义相似的干扰项误导 |
| 混合检索 | hybrid_search=ON, rerank=OFF | BM25帮助关键词匹配，但排序不一定准确 |
| 混合+重排 | hybrid_search=ON, rerank=ON | 应该返回最相关的文档 |

### 评分标准

- ✅ 正确文档排在第1位：+2分
- 🟡 正确文档排在前3位：+1分
- ❌ 正确文档不在前3位：0分

---

## 场景1：登录问题排查（技术支持类）

### 测试问题
```
登录失败怎么解决？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 登录故障排查指南 | 解决方案 | ⭐正确答案 |
| 登录功能开发文档 | 技术实现 | 干扰（开发者视角）|
| 登录日志分析 | 统计报告 | 干扰（分析数据）|
| 登录页面设计规范 | UI设计 | 干扰（设计视角）|

### 为什么这是个好测试

- **纯向量模式问题**：所有文档都包含"登录"关键词，且语义都与登录相关
- **BM25问题**："登录失败"可能与"登录日志分析"的"失败率"关键词匹配
- **重排序价值**：理解用户是"遇到问题要解决"而非"开发/分析/设计"

---

## 场景2：内存问题处理（运维类）

### 测试问题
```
程序内存溢出怎么办？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 内存泄漏排查与修复 | 解决方案 | ⭐正确答案 |
| 内存管理原理介绍 | 知识科普 | 干扰（理论知识）|
| 服务器内存升级方案 | 硬件方案 | 干扰（升级硬件）|
| 内存使用量监控配置 | 监控配置 | 干扰（只是监控）|

### 为什么这是个好测试

- **关键词高度重叠**：所有文档都频繁出现"内存"
- **语义陷阱**："内存升级"听起来也能解决内存问题，但这是硬件方案而非代码修复
- **重排序价值**：理解"内存溢出"是代码问题，需要排查修复

---

## 场景3：实体消歧（苹果）

### 测试问题
```
苹果新产品什么时候发布？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 苹果公司产品发布日历 | 发布时间表 | ⭐正确答案 |
| 苹果的种植与养护 | 农业指南 | 干扰（水果）|
| 苹果公司股票分析 | 财务报告 | 干扰（股票非产品）|
| 苹果派制作食谱 | 烹饪食谱 | 干扰（食物）|

### 为什么这是个好测试

- **实体歧义**："苹果"可以是公司也可以是水果
- **子主题歧义**：即使识别出是苹果公司，股票分析也包含"苹果"但与产品发布无关
- **重排序价值**：需要同时理解"苹果=公司"和"产品发布"的意图

---

## 场景4：Python调试（编程类）

### 测试问题
```
Python程序报错怎么调试？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| Python异常调试技巧 | 调试指南 | ⭐正确答案 |
| Python错误率统计报告 | 统计数据 | 干扰（错误率≠报错）|
| Python错误日志配置 | 日志配置 | 干扰（配置日志≠调试）|
| Python语法错误大全 | 错误列表 | 干扰（列出错误≠教调试）|

### 为什么这是个好测试

- **关键词陷阱**：所有文档都包含"Python"和"错误"
- **动词区分**：用户要的是"调试"（动作），不是"统计""配置""列举"
- **重排序价值**：识别出"调试"是核心需求

---

## 场景5：数据恢复（紧急问题）

### 测试问题
```
数据丢失了怎么恢复？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 数据恢复操作指南 | 操作步骤 | ⭐正确答案 |
| 数据备份策略 | 备份方案 | 干扰（备份≠恢复）|
| 数据恢复服务报价 | 商业服务 | 干扰（外包服务）|
| 防止数据丢失最佳实践 | 预防措施 | 干扰（预防≠恢复）|

### 为什么这是个好测试

- **时态陷阱**：用户是"已经丢失"，要恢复，不是要预防或备份
- **主体陷阱**："数据恢复服务报价"也谈恢复，但是找外包而非自己操作
- **重排序价值**：理解用户要的是"自己动手恢复"的操作指南

---

## 场景6：迁移问题（多义词）

### 测试问题
```
怎么把旧数据库的数据迁移到新数据库？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 数据库数据迁移步骤 | 数据迁移 | ⭐正确答案 |
| 服务器机房搬迁计划 | 物理迁移 | 干扰（搬服务器≠迁数据）|
| 代码仓库迁移指南 | 代码迁移 | 干扰（代码≠数据库）|
| 员工调岗流程 | 人员调动 | 干扰（人≠数据）|

### 为什么这是个好测试

- **"迁移"多义**：可以是数据迁移、物理迁移、代码迁移、人员迁移
- **关键词重叠**："迁移"在所有文档中都出现
- **重排序价值**：精准识别"数据库数据"这个限定词

---

## 场景7：网页加载慢（综合性能）

### 测试问题
```
网页打开太慢怎么优化？
```

### 文档池
| 文档 | 类型 | 相关性 |
|------|------|--------|
| 前端页面加载优化 | 前端优化 | ⭐正确答案 |
| 数据库查询性能优化 | 后端优化 | 干扰（数据库≠网页）|
| 服务器性能监控方法 | 监控配置 | 干扰（监控≠优化）|
| 网页加载统计报告 | 性能报告 | 干扰（统计≠优化）|

### 为什么这是个好测试

- **"性能"语义扩散**：所有文档都与"性能"相关
- **"网页"关键词陷阱**：统计报告也包含"网页加载"
- **动作区分**：用户要"优化"，不是"监控"或"统计"

---

## 评估表格

测试完成后填写：

| 场景 | 问题 | 纯向量 | 混合检索 | 混合+重排 |
|------|------|--------|----------|-----------|
| 1 | 登录失败怎么解决 | | | |
| 2 | 程序内存溢出怎么办 | | | |
| 3 | 苹果新产品什么时候发布 | | | |
| 4 | Python程序报错怎么调试 | | | |
| 5 | 数据丢失了怎么恢复 | | | |
| 6 | 怎么把旧数据库的数据迁移到新数据库 | | | |
| 7 | 网页打开太慢怎么优化 | | | |
| **总分** | | /14 | /14 | /14 |

---

## 预期结果

如果混合检索和重排序工作正常：

1. **纯向量模式**：预计得分 4-8 分（容易被语义相似的干扰项误导）
2. **混合检索模式**：预计得分 6-10 分（BM25帮助匹配关键词）
3. **混合+重排模式**：预计得分 10-14 分（应该能正确识别用户意图）

如果三种模式得分接近，说明测试场景设计还不够有区分度，或者模型本身区分能力有限。

# 内存使用量监控配置指南

## 概述

本文档介绍如何配置Prometheus + Grafana监控系统的内存指标。

## Prometheus配置

在`prometheus.yml`中添加以下抓取配置：

```yaml
scrape_configs:
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
    metrics_path: /metrics
    scrape_interval: 15s
```

## 关键内存指标

| 指标名称 | 说明 |
|----------|------|
| node_memory_MemTotal_bytes | 总内存 |
| node_memory_MemFree_bytes | 空闲内存 |
| node_memory_MemAvailable_bytes | 可用内存 |
| node_memory_Buffers_bytes | 缓冲区 |
| node_memory_Cached_bytes | 缓存 |

## Grafana仪表盘

### 内存使用率面板

PromQL查询：
```
100 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100)
```

### 告警规则

当内存使用率超过80%时触发告警：
```yaml
groups:
  - name: memory
    rules:
      - alert: HighMemoryUsage
        expr: (1 - node_memory_MemAvailable_bytes/node_memory_MemTotal_bytes) > 0.8
        for: 5m
        labels:
          severity: warning
```

## 最佳实践

- 设置多级告警阈值（80%警告，90%严重）
- 保留至少15天的历史数据
- 配置钉钉/邮件告警通知
